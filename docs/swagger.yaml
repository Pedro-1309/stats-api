# Overview of the API
openapi: 3.1.1
info:
  title: Stats API
  version: 1.0.0
  description: API for managing game statistics, win rates, and match history for players.
      
paths:
  /stats/{userId}:
    get:
      summary: Get player global statistics
      description: Returns total games, wins, losses, and calculated win rate for a specific user.
      tags: [Statistics]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
          description: The unique ID of the user.
      responses:
        200:
          description: Statistics retrieved successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalGames: { type: integer, example: 50 }
                  totalWins: { type: integer, example: 30 }
                  totalLosses: { type: integer, example: 20 }
                  winRate: { type: string, example: "60.00%" }
        404:
          description: User not found.
        500:
          description: Server error.

    post:
      summary: Initialize stats for a new player
      description: Creates a new stats record for a player who hasn't played before.
      tags: [Statistics]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        201:
          description: Stats record created successfully.
        400:
          description: User already exists.
        500:
          description: Server error.

    put:
      summary: Add a new match result
      description: Updates total counters and adds the match to the history (keeping only the last 10).
      tags: [Statistics]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MatchUpdate'
      responses:
        200:
          description: Result added and stats updated.
        404:
          description: User not found.
        500:
          description: Server error.

    delete:
      summary: Remove player statistics
      description: Permanently deletes all stats and history for the specified user.
      tags: [Statistics]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        200:
          description: Stats removed successfully.
        404:
          description: User not found.

  /stats/history/{userId}:
    get:
      summary: Get match history
      description: Returns an array of the last 10 matches played by the user.
      tags: [History]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        200:
          description: A list of the most recent matches.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/HistoryEntry'
        404:
          description: History not found.

components:
  # -------------------------
  # SECURITY SCHEMES
  # -------------------------
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  # -------------------------
  # DATA SCHEMAS
  # -------------------------
  schemas:
    MatchUpdate:
      type: object
      required:
        - result
        - role
        - numbOfPlayers
        - gameMode
      properties:
        result:
          type: string
          enum: [won, lost]
        role:
          type: string
          example: "Archer"
        numbOfPlayers:
          type: integer
          example: 8
        gameMode:
          type: string
          enum: [classic, advanced]

    HistoryEntry:
      type: object
      properties:
        result: { type: string, enum: [won, lost] }
        role: { type: string }
        numbOfPlayers: { type: integer }
        gameMode: { type: string, enum: [classic, advanced] }
        playedAt: { type: string, format: date-time }